angular.module("youtube-embed",["ng"]).service("youtubeEmbedUtils",["$window","$rootScope",function(e,t){function o(e,t){return e.indexOf(t)>-1}function n(){t.$apply(function(){a.ready=!0})}var a={},r=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,i=/t=(\d+)[ms]?(\d+)?s?/;return a.getIdFromURL=function(e){var t=e.replace(r,"$1");if(o(t,";")){var n=t.split(";");if(o(n[1],"%")){var a=decodeURIComponent(n[1]);t=("http://youtube.com"+a).replace(r,"$1")}else t=n[0]}else o(t,"#")&&(t=t.split("#")[0]);return t},a.getTimeFromURL=function(e){e=e||"";var t=e.match(i);if(!t)return 0;var n=t[0],a=t[1],r=t[2];return"undefined"!=typeof r?(r=parseInt(r,10),a=parseInt(a,10)):o(n,"m")?(a=parseInt(a,10),r=0):(r=parseInt(a,10),a=0),r+60*a},a.ready=!1,"undefined"==typeof YT?e.onYouTubeIframeAPIReady=n:YT.loaded?a.ready=!0:YT.ready(n),a}]).directive("youtubeVideo",["$window","youtubeEmbedUtils",function(e,t){var o=1,n={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"queued"},a="youtube.player.";return e.YTConfig={host:"https://www.youtube.com"},{restrict:"EA",scope:{videoId:"=?",videoUrl:"=?",player:"=?",playerVars:"=?",playerHeight:"=?",playerWidth:"=?"},link:function(e,r,i){function s(){var t=Array.prototype.slice.call(arguments);e.$apply(function(){e.$emit.apply(e,t)})}function l(t){var o=n[t.data];"undefined"!=typeof o&&s(a+o,e.player,t),e.$apply(function(){e.player.currentState=o})}function u(t){s(a+"ready",e.player,t)}function d(t){s(a+"error",e.player,t)}function c(){var t=angular.copy(e.playerVars);t.start=t.start||e.urlStartTime;var o=new YT.Player(p,{height:e.playerHeight,width:e.playerWidth,videoId:e.videoId,playerVars:t,events:{onReady:u,onStateChange:l,onError:d}});return o.id=p,o}function f(){(e.videoId||e.playerVars.list)&&(e.player&&"function"==typeof e.player.destroy&&e.player.destroy(),e.player=c())}e.utils=t;var p=i.playerId||r[0].id||"unique-youtube-embed-id-"+o++;r[0].id=p,e.playerHeight=e.playerHeight||390,e.playerWidth=e.playerWidth||640,e.playerVars=e.playerVars||{};var h=e.$watch(function(){return e.utils.ready&&("undefined"!=typeof e.videoUrl||"undefined"!=typeof e.videoId||"undefined"!=typeof e.playerVars.list)},function(t){t&&(h(),"undefined"!=typeof e.videoUrl?e.$watch("videoUrl",function(t){e.videoId=e.utils.getIdFromURL(t),e.urlStartTime=e.utils.getTimeFromURL(t),f()}):"undefined"!=typeof e.videoId?e.$watch("videoId",function(){e.urlStartTime=null,f()}):e.$watch("playerVars.list",function(){e.urlStartTime=null,f()}))});e.$watchCollection(["playerHeight","playerWidth"],function(){e.player&&e.player.setSize(e.playerWidth,e.playerHeight)}),e.$on("$destroy",function(){e.player&&e.player.destroy()})}}}]),angular.module("wnh",["firebase","youtube-embed","ngMaterial","ngMessages","ngRoute","wnh.filters","wnh.controllers","wnh.components","wnh.main","wnh.post"]).config(["$locationProvider","$routeProvider","$mdThemingProvider","$compileProvider",function(e,t,o,n){var a={"default":"400","hue-1":"50","hue-2":"200","hue-3":"A100"};o.definePalette("primary",{50:"#abb9d5",100:"#798fbb",200:"#5570a7",300:"#3d5078",400:"#324363",500:"#28354f",600:"#1e273b",700:"#131a26",800:"#090c12",900:"#000000",A100:"#abb9d5",A200:"#798fbb",A400:"#324363",A700:"#131a26",contrastDefaultColor:"light",contrastDarkColors:"50 A100"}),o.definePalette("accent",{50:"#ffffff",100:"#c1ddf0",200:"#94c5e6",300:"#5aa5d8",400:"#4298d2",500:"#2f89c6",600:"#2978ad",700:"#236794",800:"#1d567c",900:"#184563",A100:"#ffffff",A200:"#c1ddf0",A400:"#4298d2",A700:"#236794",contrastDefaultColor:"light",contrastDarkColors:"50 A100"}),o.definePalette("warn",{50:"#ffffff",100:"#fde5c9",200:"#fbcb92",300:"#f9a94d",400:"#f89b30",500:"#f78d12",600:"#e37d08",700:"#c56d07",800:"#a85d06",900:"#8a4c05",A100:"#ffffff",A200:"#fde5c9",A400:"#f89b30",A700:"#c56d07",contrastDefaultColor:"light",contrastDarkColors:"50 A100"}),o.theme("default").primaryPalette("primary",a).accentPalette("accent",a).warnPalette("warn",a).backgroundPalette("grey",{"default":"50","hue-1":"100","hue-2":"200","hue-3":"A100"}),e.html5Mode(!0),t.otherwise({redirectTo:"/"}),n.debugInfoEnabled(!1);var r={apiKey:"AIzaSyA9mff-Z4l_jkT4rJrvwf2YyozlBxU6gRk",authDomain:"world-needs-heroes.firebaseapp.com",databaseURL:"https://world-needs-heroes.firebaseio.com",storageBucket:"world-needs-heroes.appspot.com"};firebase.initializeApp(r)}]),angular.module("wnh.components",["wnh.services"]).component("wnhPost",{templateUrl:"views/components/post.html",controller:["$rootScope","$scope","$window","Database","Auth","Dialogs","YoutubePlayers",function(e,t,o,n,a,r,i){var s=function(){n.hasVote(t.playof.key).then(function(e){e.val()&&(t.hasVote=!0)})};t.playof=this.playof,t.voteIsHover=!1,t.hasVote=!1,t.author=null,t.currentUser=a.getUser(),t.vote=function(){a.getUser()?n.vote(t.playof.key,t.hasVote).then(function(){t.hasVote=!t.hasVote,t.hasVote?(t.playof.votesCount++,ga("send","event","playof","add_vote")):(t.playof.votesCount--,ga("send","event","playof","remove_vote"))})["catch"](function(e){}):r.showLoginDialog()},this.$onInit=function(){a.getUser()&&n.hasVote(t.playof.key).then(function(e){e.val()&&(t.hasVote=!0)}),n.getProfile(t.playof.userId).then(function(e){e.val()&&(t.author=e.val())})},t.$on("youtube.player.ready",function(e,t){i.registerPlayer(t)}),t.$on("youtube.player.playing",function(e,t){i.pauseAllPlayers(t)}),e.$on("authChanged",function(e,o){t.currentUser=o,o?s():t.hasVote=!1})}],bindings:{playof:"="}}),angular.module("wnh.controllers",["wnh.services"]).controller("ToolbarCtrl",["$rootScope","$scope","Auth","Database","Utils","Dialogs","DataFilters",function(e,t,o,n,a,r,i){t.auth=o,t.dialogs=r,t.dataFilters=i,t.currentUser=null,t.timeframes=a.timeframesList,t.heroes=a.heroesList,t.currentTimeframe=i.getTimeframe(),t.currentHero=i.getHero(),t.openMenu=function(e,t){e(t)},t.getTimeframeInfo=function(e,o){for(var n=0;n<t.timeframes.length;n++)if(e===t.timeframes[n].filter)return t.timeframes[n][o]},e.$on("authChanged",function(e,o){t.currentUser=o}),e.$on("dataFiltersTimeframeChanged",function(e,o){t.currentTimeframe=o}),e.$on("dataFiltersHeroChanged",function(e,o){t.currentHero=o})}]).controller("PostBtnCtrl",["$scope","Dialogs",function(e,t){e.dialogs=t}]),angular.module("wnh.filters",["wnh.services"]).filter("heroName",["Utils",function(e){return function(t){return e.heroesList[t]&&e.heroesList[t].name}}]),angular.module("wnh.services",[]).factory("Utils",["$mdToast",function(e){return{heroesList:{genji:{id:"genji",name:"Genji"},mccree:{id:"mccree",name:"Mccree"},pharah:{id:"pharah",name:"Pharah"},reaper:{id:"reaper",name:"Reaper"},soldier76:{id:"soldier76",name:"Soldier: 76"},tracer:{id:"tracer",name:"Tracer"},bastion:{id:"bastion",name:"Bastion"},hanzo:{id:"hanzo",name:"Hanzo"},junkrat:{id:"junkrat",name:"Junkrat"},mei:{id:"mei",name:"Mei"},torbjorn:{id:"torbjorn",name:"Torbjörn"},widowmaker:{id:"widowmaker",name:"Widowmaker"},dva:{id:"dva",name:"D.VA"},reinhardt:{id:"reinhardt",name:"Reinhardt"},roadhog:{id:"roadhog",name:"Roadhog"},winston:{id:"winston",name:"Winston"},zarya:{id:"zarya",name:"Zarya"},lucio:{id:"lucio",name:"Lúcio"},mercy:{id:"mercy",name:"Mercy"},symmetra:{id:"symmetra",name:"Symmetra"},zenyatta:{id:"zenyatta",name:"Zenyatta"}},timeframesList:[{filter:"week",title:"7 days",icon:"view_week"},{filter:"day",title:"Last day",icon:"view_day"},{filter:"all",title:"Overall",icon:"history"}],itemsPerPage:5,overallLimit:300,showToast:function(t){e.show(e.simple().textContent(t).hideDelay(4e3))}}}]).factory("DataFilters",["$rootScope",function(e){var t="week",o="";return{getTimeframe:function(){return t},getHero:function(){return o},setTimeframe:function(o){t=o,e.$broadcast("dataFiltersTimeframeChanged",o)},setHero:function(t){o=t,e.$broadcast("dataFiltersHeroChanged",t)}}}]).factory("YoutubePlayers",[function(){var e=[];return{registerPlayer:function(t){e.push(t)},pauseAllPlayers:function(t){e.forEach(function(e){e.id!==t.id&&1===e.getPlayerState()&&e.pauseVideo()})}}}]).factory("Youtube",["$http",function(e){var t="AIzaSyAyY4cymf3FIT7lOGltKv1WthHZlR7npkI",o="https://www.googleapis.com/youtube/v3/";return{getVideoInfo:function(n){return e({method:"GET",url:o+"videos?id="+n+"&key="+t+"&fields=items(id,snippet(title,thumbnails))&part=snippet"})}}}]).factory("Auth",["$rootScope","$firebaseAuth",function(e,t){var o=t(),n=null;return o.$onAuthStateChanged(function(t){n=t,e.$broadcast("authChanged",t)}),{logout:function(){return o.$signOut()},getUser:function(){return n},providerLogin:function(e){var t=new firebase.auth[e+"AuthProvider"];return"Facebook"===e?o.$signInWithRedirect(t):o.$signInWithPopup(t)}}}]).factory("Dialogs",["$mdDialog","Auth",function(e,t){return{showLoginDialog:function(t){var o=this;e.show({controller:["$scope","$mdDialog","Auth","Database",function(e,t,n,a){e.hide=function(){t.hide()},e.login=function(e){n.providerLogin(e).then(function(e){ga("send","event","user","register"),t.hide(),a.getProfile(e.user.uid).then(function(e){var t=e.val();(!t||t&&!t.onboarding)&&o.showOnboardingDialog()})})["catch"](function(e){})}}],templateUrl:"./views/dialogs/loginDialog.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0}).then(function(e){},function(){})},showOnboardingDialog:function(o){e.show({controller:["$scope","$mdDialog","Database",function(e,o,n){e.onboard=function(){n.saveProfile({name:e.onboarding.displayName,battletag:e.onboarding.battleTag,picture:t.getUser().photoURL,onboarding:!0},function(){ga("send","event","user","onboarding")}),o.hide()}}],templateUrl:"./views/dialogs/onboardingDialog.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!1}).then(function(e){},function(){})},showPostDialog:function(o){t.getUser()?e.show({controller:["$scope","$mdDialog","$location","Utils","Youtube","Database",function(e,t,o,n,a,r){e.heroesList=n.heroesList,e.invalidId=!1,e.newPost={videoLink:"",hero:""},e.videoLinkChange=function(){e.invalidId=!1},e.post=function(){if(e.newPost.videoLink&&e.newPost.hero){var i=e.newPost.videoLink.match(/(?:youtube\.com\/\S*(?:(?:\/e(?:mbed))?\/|watch\?(?:\S*?&?v\=))|youtu\.be\/)([a-zA-Z0-9_-]{6,11})/i),s=null;s=i&&11===i[1].length?i[1]:e.newPost.videoLink,s&&11===s.length?a.getVideoInfo(s).then(function(a){if(a.data.items.length){var i={youtubeId:s,hero:e.newPost.hero};e.newPost.description&&(i.description=e.newPost.description);var l=r.newPost(i);l?(ga("send","event","playof","post"),o.path("/post/"+l),n.showToast("Your play of the game has been posted")):n.showToast("Error, please try again later"),t.hide()}else e.invalidId=!0},function(e){n.showToast("Error, please try again later")}):e.invalidId=!0}},e.hide=function(){t.hide()}}],templateUrl:"./views/dialogs/postDialog.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!0}).then(function(e){},function(){}):this.showLoginDialog()}}}]).factory("Database",["Auth","Utils",function(e,t){var o=firebase.database();return{getProfile:function(e){return o.ref("profile/"+e).once("value")},saveProfile:function(t,n){e.getUser()&&o.ref("profile/"+e.getUser().uid).update(t,n)},newPost:function(t){if(e.getUser()){t.userId=e.getUser().uid,t.votesCount=0,t.postedAt=firebase.database.ServerValue.TIMESTAMP;var n=o.ref("posts").push();return n.set(t).then(function(t){o.ref("profile/"+e.getUser().uid+"/posts/"+n.key).set(!0)}),n.key}},vote:function(t,n){if(e.getUser())return o.ref("posts/"+t+"/votesCount").once("value").then(function(a){var r={};return n?(r["posts/"+t+"/votesCount"]=a.val()-1,r["votes/"+t+"/"+e.getUser().uid]=null):(r["posts/"+t+"/votesCount"]=a.val()+1,r["votes/"+t+"/"+e.getUser().uid]=firebase.database.ServerValue.TIMESTAMP),o.ref().update(r)})},hasVote:function(t){if(e.getUser())return o.ref("votes/"+t+"/"+e.getUser().uid).once("value")},getPlayofList:function(e){var n=o.ref("posts"),a=0,r=moment().valueOf();return"all"===e?n.orderByChild("votesCount").limitToLast(t.overallLimit):("day"===e?a=moment().subtract(1,"days").valueOf():"week"===e&&(a=moment().subtract(7,"days").valueOf()),n.orderByChild("postedAt").startAt(a).endAt(r))},getPlayof:function(e){return o.ref("posts/"+e).once("value")}}}]),angular.module("wnh.main",["ngRoute","wnh.services"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"../../views/main.html",controller:"MainCtrl"})}]).controller("MainCtrl",["$rootScope","$scope","Auth","Database","Utils","DataFilters",function(e,t,o,n,a,r){var i=function(){t.page=1,t.limit=t.page*a.itemsPerPage},s=function(e,o){i(),t.playofList=[],n.getPlayofList(o).on("child_added",function(e){var o=e.val();o.key=e.key,t.$apply(function(){t.playofList.push(o)})})};t.playofList=[],t.currentHero=r.getHero(),t.showMore=function(){t.page++,t.limit=t.page*a.itemsPerPage},i(),s(),e.$on("dataFiltersTimeframeChanged",s),e.$on("dataFiltersHeroChanged",function(e,o){t.currentHero=o})}]),angular.module("wnh.post",["ngRoute","wnh.services"]).config(["$routeProvider",function(e){e.when("/post/:postId",{templateUrl:"../../views/post.html",controller:"PostCtrl"})}]).controller("PostCtrl",["$rootScope","$scope","$routeParams","Auth","Database",function(e,t,o,n,a){var r=o.postId;t.inProgress=!0,t.playof=null,a.getPlayof(r).then(function(e){t.$apply(function(){e.val()?(t.playof=e.val(),t.playof.key=e.key,t.inProgress=!1):(t.inProgress=!1,t.playof=null)})})["catch"](function(e){t.$apply(function(){t.inProgress=!1,t.playof=null})})}]),function(e,t,o,n,a,r,i){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,r=t.createElement(o),i=t.getElementsByTagName(o)[0],r.async=1,r.src=n,i.parentNode.insertBefore(r,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-7759211-12","auto"),ga("send","pageview");